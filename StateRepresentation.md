# 论文第三部分

状态机，用高阶马尔科夫链进行表述。

## 1如何来表示状态

一般来说，电路每个状态的持续时间，开始时间，结束时间都是不确定的。

那么该如何解析出这些状态呢。

第一种想法是直接分段来进行状态表示，但是开始时间结束时间不定。

第二种想法是利用最小二乘法分段线性进行拟合

## 2如何训练这个状态机

然后利用拟合结果进行GMM聚类。

这样就可以把时间序列表示成不定长线段的组合。

然后利用初始状态训练一个三阶或者四阶的马尔科夫链。

有时候数据量不够，所以需要考虑利用自然语言处理训练马尔科夫链的一种平滑的方法。

计算概率的时候，朴素的计算方法是通过计数的方式：
$$
p=\frac{n}{N}
$$
这样的话值域范围是0-1，但是如果是0就会产生一个奇点，容易被中断。

所以采用一种平滑的方式来计算：
$$
p = \frac{1+n}{1+N}
$$
当n比较大接近N的时候，这个的结果和上式结果相近，影响不打。

但是当n为0的时候，p=1/(1+N),此时为最小值兜底，更具有鲁棒价值。

### 3如何利用这个马尔科夫链进行表述

在测试阶段，就可以利用这个马尔科夫链表示出每个状态的概率。

然后利用一定的机制来积累这个概率，概率低到一定程度认为发生了异常。
$$
score_t = (1-\beta)score_{t-1}+\beta p_{markov}
$$
可以直接利用马尔科夫的序列概率来计算。
$$
p(s_{t-3},s_{t-2},s_{t-1},s_{t}) = \prod_{x=t-3}^tp(s_x|s_{x-1},s_{x-2},s_{x-3})
$$

## 4为什么要这样设计

因为单个状态持续的点数大，如果直接使用隐马尔科夫模型，要求使用的马尔科夫模型的阶数就会非常高。

